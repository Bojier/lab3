Лабораторная работа 2 "Разработка драйверов сетевых устройств"
p3404c Ван Лиша Ван Юйе 

Цель работы: Получить знания и навыки разработки драйверов сетевых интерфейсов для операционной системы Linux.

Задачи:
1.Написать драйвер сетевого интерфейса, удовлетворяющийтребованиям:
1.1. Драйвер должен создавать виртуальный сетевой интерфейс в ОС Linux.
1.2. Созданный сетевой интерфейс должен перехватывать пакеты родительского интерфейса (eth0 или другого).
1.3. Сетевой интерфейс должен реализовывать логику работы с перехваченным трафиком в соответствии с заданиями по вариантам.
1.4. Должна иметься возможность просмотра статистики работы созданного интерфейса.

вариант 1

Пакеты протокола ICMP (Internet Control Message Protocol) – только тип 8. Вывести данные.
Состояние разбора пакетов необходимо выводить в файл в директории /proc

Описание функциональности драйвера

При загрузке драйвер создает сетевой интерфейс vni0, который наследует настройки от интерфейса lo.
Помимо этого он создает файл /proc/var1 с правами на чтение.

Captured ICMP package
Type: 8
Code: 0
При чтении файла /proc/var1 выводится информация о количестве обработанных и отброшенных пакетов:

Processed: 2; Dropped: 2
Где Processed: количество пакетов, которые подошли по условию; Dropped: количество пакетов, которые были отброшены.

Инструкция по сборке

Выполнить команду sudo make

Инструкция пользователя

Для загрузки модуля выполнить команду sudo insmod lab3.ko

Для проверки кольцевого буфера в отдельном окне консоли выполнить команду: dmesg -w

Для проверки содержимого служебного файла: cat /proc/var1

Для удаления модуля: sudo rmmod lab3

Примеры использования

Для того, чтобы драйвер начал работать, необходимо обеспечить трафик на интерфейсе lo, имеющем адрес 127.0.0.1.

Воспользуемся для этого командой ping. После загрузки модуля необходимо выполнить:

ping 127.0.0.1
